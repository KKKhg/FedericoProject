<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapperInterface.ClientMapper">

	<!-- 클라이언트 selectOne (WHERE = ID) -->
	<select id="selectOne" resultType="vo.ClientVO">
		SELECT * FROM client where clientId = #{clientId}
	</select>
	<!-- 클라이언트 selectOne (WHERE = Phone) -->
	<select id="selectOnePhone" resultType="vo.ClientVO">
		SELECT * FROM client where clientPhone = #{clientPhone}
	</select>
	
	
	
<!-- ======================= 카트 관련 ====================== -->
	
	<resultMap type="vo.CartVO" id="CartVO">
		<result property="cartSeq" column="cartSeq"/>
		<result property="clientId" column="clientId"/>
		<result property="menuQty" column="menuQty"/>
		<collection property="menuVo" resultMap="MenuVO"></collection>
	</resultMap>
	
	<resultMap type="vo.MenuVO" id="MenuVO">
		<result property="menuIndex" column="menuIndex"/>
		<result property="menuName" column="menuName"/>
		<result property="menuFlag" column="menuFlag"/>
		<result property="menuPrice" column="menuPrice"/>
		<result property="menuImage" column="menuImage"/>
	</resultMap>
	
	
	
	<!-- 회원장바구니에 항목 추가 -->
	<insert id="insertCart">
		INSERT INTO cart(cartseq, clientid, menuindex, menuqty)
		VALUES ((SELECT nvl(max(cartseq),0)+1 FROM cart), #{clientId}, #{menuVo.menuIndex}, #{menuQty})
	</insert>
	
	
	<!-- 회원장바구니 조회 by 고객 -->
	<select id="selectCartbyClient" resultMap="CartVO">
		SELECT c.*, m.* FROM cart c, menuinfo m WHERE clientid = #{clientId} AND c.menuindex = m.menuindex
	</select>
	
	<!-- 회원장바구니 메뉴 수량변경  -->
	<update id="updateCart">
		UPDATE cart SET menuqty = #{menuQty} WHERE cartseq = #{cartSeq}
	</update>
	
	<!-- 회원장바구니 1품목 삭제 -->
	<delete id="deleteCart">
		DELETE FROM cart WHERE cartseq = #{cartSeq}
	</delete>
	
	<!-- 특정회원 장바구니 삭제 -->
	<delete id="deleteCartbyClientId">
		DELETE FROM cart WHERE clientid = #{clientId}
	</delete>

<!-- ======================= 카트 관련 ====================== -->



<!-- ======================= 주문등록 관련 ====================== -->

	<!-- 주문정보 등록 -->
	<insert id="insertOrderList" parameterType="hashmap">
		INSERT INTO orderlist(ordernumber, clientid, fcid, completeyn, memo, orderdate)
		VALUES ((SELECT nvl(max(ordernumber),0)+1 from orderlist), #{clientId}, #{fcId}, 'N' , nvl(#{memo},'X'), sysdate)
	</insert>


	<!-- 주문상세정보 등록 -->
	<insert id="insertOrderDetailList">
		<selectKey keyProperty="ordernumber" resultType="int" order="BEFORE">
			SELECT max(ordernumber) FROM orderlist WHERE clientid =  #{clientId}
		</selectKey>
		INSERT INTO orderdetaillist (orderdetailnumber, ordernumber, menuindex, menuqty)
		<foreach collection="list" item="vo" separator=" UNION ALL " index="index">
			<set></set>
			SELECT (SELECT nvl(max(orderdetailnumber),0)+1+${index} FROM orderdetaillist),
			 #{ordernumber}, #{vo.menuVo.menuIndex}, #{vo.menuQty} FROM DUAL
		</foreach>
	</insert>





<!-- ======================= 주문등록 관련 ====================== -->

</mapper>










